<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Products</title>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
:root{
--sidebar-width:170px;
--sidebar-collapsed-width:75px;
--layout-gap:16px;
}

body{background:#f8f9fa;overflow-x:hidden;}

.sidebar{
width:var(--sidebar-width);
height:100vh;
position:fixed;
background:#fff;
border-right:1px solid #dee2e6;
padding:20px 12px;
}
.sidebar.collapsed{width:var(--sidebar-collapsed-width);}
.sidebar.collapsed .link-text,.sidebar.collapsed h4{display:none;}
.sidebar .nav-link{padding:12px 15px;border-radius:8px;margin-bottom:6px;display:flex;color:#495057;}
.sidebar .nav-link.active{background:#0d6efd;color:#fff;}

.navbar{margin-left:calc(var(--sidebar-width)+var(--layout-gap));}
.content{margin-left:calc(var(--sidebar-width)+var(--layout-gap));padding:20px;}
.collapsed-margin{margin-left:calc(var(--sidebar-collapsed-width)+var(--layout-gap))!important;}

@media(max-width:991px){
.navbar,.content{margin-left:0!important;}
.sidebar{left:-100%;}
.sidebar.mobile-show{left:0;}
}

.product-card{border:none;border-radius:14px;transition:.25s;}
.product-card:hover{transform:translateY(-4px);box-shadow:0 10px 20px rgba(0,0,0,.12);}
.product-img-container{height:180px;background:#f1f1f1;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.product-img-container img{width:100%;height:100%;object-fit:cover;}

.dark-mode{background:#121212;color:#e0e0e0;}
.dark-mode .sidebar,.dark-mode .navbar,.dark-mode .card{background:#1a1a1a;color:#e6e6e6;border-color:#2c2c2c;}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
<h4 class="px-3 mb-4 text-primary fw-bold">Admin</h4>
<a href="product.html" class="nav-link"><i class="bi bi-box"></i><span class="link-text ms-2">Products</span></a>
</div>

<!-- NAVBAR -->
<nav class="navbar sticky-top bg-white shadow-sm px-3 py-2" id="navbar">
<div class="container-fluid">
<button class="btn btn-light border" id="toggle-btn"><i class="bi bi-list"></i></button>
<input id="searchBox" class="form-control ms-2" placeholder="Search products..." style="max-width:260px;">
<button class="btn btn-light border ms-2" onclick="toggleDark()">
<i id="darkIcon" class="bi bi-moon-stars"></i>
</button>
<button class="btn btn-primary ms-2" data-bs-toggle="modal" data-bs-target="#productModal" onclick="resetProductForm()">
<i class="bi bi-plus-circle"></i> Add
</button>
</div>
</nav>

<!-- CONTENT -->
<div class="content">
<div class="container-fluid">
<div class="row g-4" id="productList"></div>
</div>
</div>

<!-- PRODUCT MODAL -->
<div class="modal fade" id="productModal">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header bg-primary text-white">
<h5>Add Product</h5>
<button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body">
<form id="prodForm" novalidate>

<div class="mb-3">
<label>Name</label>
<input id="pName" class="form-control" required>
</div>

<div class="mb-3">
<label>Price</label>
<input id="pPrice" type="number" class="form-control" required>
</div>

<div class="mb-3">
<label>Category</label>
<select id="pCat" class="form-select">
<option>Electronics</option>
<option>Fashion</option>
<option>Home</option>
</select>
</div>

<div class="mb-3">
<label>Description</label>
<textarea id="pDesc" class="form-control" required></textarea>
</div>

<div class="mb-3">
<label>Image</label>
<input type="file" id="pImg" class="form-control" accept="image/*">
<img id="preview" style="max-height:120px;display:none;margin-top:10px;border-radius:8px;">
</div>

</form>
</div>

<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<button class="btn btn-primary" onclick="saveProduct()">Save</button>
</div>
</div>
</div>
</div>

<!-- TOAST -->
<div class="toast position-fixed bottom-0 end-0 m-3" id="toast">
<div class="toast-body bg-success text-white">Product added</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const products=[];

function safe(t){return $("<div>").text(t).html();}

function previewImage(input){
if(input.files[0]){
let r=new FileReader();
r.onload=e=>{
preview.src=e.target.result;
preview.style.display="block";
};
r.readAsDataURL(input.files[0]);
}
}

pImg.onchange=e=>previewImage(e.target);

function card(p){
return `
<div class="col-xl-3 col-lg-4 col-md-6">
<div class="card product-card h-100 shadow-sm">
<div class="product-img-container">
<img src="${p.img||'https://via.placeholder.com/300x200?text=No+Image'}">
</div>
<div class="card-body">
<div class="d-flex justify-content-between mb-2">
<h6>${safe(p.name)}</h6>
<span class="badge bg-info">${p.cat}</span>
</div>
<p class="small text-muted">${safe(p.desc)}</p>
<div class="d-flex justify-content-between">
<b>â‚¹${p.price.toLocaleString()}</b>
<button class="btn btn-sm btn-outline-danger" onclick="delProd('${p.id}')">
<i class="bi bi-trash"></i></button>
</div>
</div>
</div>
</div>`;
}

function render(){
let q=searchBox.value.toLowerCase();
productList.innerHTML=products
.filter(p=>p.name.toLowerCase().includes(q))
.map(card).join("");
}

function saveProduct(){
if(!prodForm.checkValidity()){
prodForm.classList.add("was-validated");
return;
}
products.unshift({
id:crypto.randomUUID(),
name:pName.value,
price:Number(pPrice.value),
cat:pCat.value,
desc:pDesc.value,
img:preview.src||""
});
render();
bootstrap.Modal.getInstance(productModal).hide();
resetProductForm();
new bootstrap.Toast(toast).show();
}

function resetProductForm(){
prodForm.reset();
prodForm.classList.remove("was-validated");
preview.style.display="none";
}

function delProd(id){
products.splice(products.findIndex(p=>p.id===id),1);
render();
}

searchBox.oninput=render;

/* SIDEBAR */
toggleBtn.onclick=()=>{
if(innerWidth<992){sidebar.classList.toggle("mobile-show");return;}
sidebar.classList.toggle("collapsed");
navbar.classList.toggle("collapsed-margin");
content.classList.toggle("collapsed-margin");
};

/* DARK MODE */
if(localStorage.theme==="dark"){
document.body.classList.add("dark-mode");
darkIcon.className="bi bi-sun";
}
function toggleDark(){
document.body.classList.toggle("dark-mode");
localStorage.theme=document.body.classList.contains("dark-mode")?"dark":"light";
darkIcon.className=document.body.classList.contains("dark-mode")?"bi bi-sun":"bi bi-moon-stars";
}

/* ACTIVE LINK */
let cur=location.pathname.split("/").pop();
document.querySelectorAll(".sidebar a").forEach(a=>{
if(a.getAttribute("href")===cur) a.classList.add("active");
});
</script>

</body>
</html>
